---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import "../style/style.css";
const documents = await Astro.glob("../content/documents/*.md");
const doc_texts = documents.map((doc) => doc.rawContent());
const doc_headings = documents.map((doc) => doc.frontmatter.title)
import * as greetingText from "../content/welcome.md";
const greeting_text = greetingText.rawContent();
---

<Layout title="Welcome to Astro.">
	<main>
		<script define:vars={{ doc_texts, doc_headings, greeting_text }}>
			var scanlines = $(".scanlines");
			var tv = $(".tv");
			var divider = "----------------------------------------------";

			var help_texts = [
				["help", "List available commands"],
				["ls", "Lists available documents"],
				["read <index>", "Open a document"],
				["clear", "Clears the terminal"],
			];

			var terminal = $("main").terminal(
				{
					help: function () {
						const padding_width = 16;
						var header = "Command         Description";
						this.echo(header);
						this.echo("-".repeat(header.length));
						for (let i = 0; i < help_texts.length; i++) {
							const element = help_texts[i];
							const cmd = element[0];
							const text = element[1];
							var padding = " ".repeat(
								padding_width - cmd.length,
							);
							this.echo(cmd + padding + text);
						}
					},
					echo: function (arg1) {
						this.echo(arg1);
					},
					ls: function () {
						// Note 4 spaces for split
						var header = "Index    Title";
						this.echo(header);
						this.echo("-".repeat(header.length));
						for (let i = 0; i < doc_headings.length; i++) {
							var padding = 9 - i.toString().length;
							this.echo(
								"" +
									(i + 1) +
									" ".repeat(padding) +
									doc_headings[i],
							);
						}
					},
					read: function (index) {
						try {
							console.log(index);
							this.echo(
								`[[bu;;]` +
									doc_headings[index-1] +
									`]\n`,
							);
							this.typing(
								"echo",
								"10",
								doc_texts[index-1],
							);
						} catch (err) {
							console.log(err);
							this.echo("[[;red;]Index not found!]");
						}
					},
				},
				{
					prompt: "$ ",
					greetings: false,
					onInit: function () {
						this.echo(divider);
						this.echo(greeting_text);
						this.echo(divider);
					},
				},
			);
		</script>
		<div class="tv">
			<div id="terminal"></div>
			<div class="flicker"></div>
			<div class="scanlines"></div>
			<div class="noise"></div>
		</div>
	</main>
</Layout>
